(dp1
S'output'
p2
S''
sS'layer'
p3
S'applications/blog/views/default/category.html'
p4
sS'code'
p5
S'\nresponse.write(\'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">\\r\\n<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr">\\r\\n    <head profile="http://gmpg.org/xfn/11">\\r\\n\\r\\n        <meta http-equiv="content-type" content="text/html; charset=utf-8" />\\r\\n        <meta name="keywords" content="\',escape=False)\nresponse.write(response.keywords)\nresponse.write(\'" />\\r\\n        <meta name="description" content="\',escape=False)\nresponse.write(response.description)\nresponse.write(\'" />\\r\\n        \\r\\n        <title>\',escape=False)\nif response.title:\n    response.write(\'\',escape=False)\n    response.write(response.title)\n    response.write(\'\',escape=False)\nelse:\n    response.write(\'\',escape=False)\n    response.write(URL(r=request))\n    response.write(\'\',escape=False)\n    pass\nresponse.write(\'</title>\\r\\n\\r\\n        <link rel="stylesheet" href="/\',escape=False)\nresponse.write(request.application)\nresponse.write(\'/static/style.css" type="text/css" media="screen" />\\r\\n\\r\\n        <style type="text/css" media="screen">\\r\\n            #page { background: url("/\',escape=False)\nresponse.write(request.application)\nresponse.write(\'/static/bg-ltr.jpg") repeat-y top; border: none; }\\r\\n        \\t#flash { \\r\\n\\t\\t\\t\\twidth: 450px; \\r\\n\\t\\t\\t\\tmargin: 0 auto; \\r\\n\\t\\t\\t\\ttext-align: center; \\r\\n\\t\\t\\t\\tclear: both; \\r\\n\\t\\t\\t\\tborder: 1px #000000; \\r\\n\\t\\t\\t\\tbackground-color: #6cade3; \\r\\n\\t\\t\\t\\tcolor: white; \\r\\n\\t\\t\\t\\tpadding-top: 1.0em; \\r\\n\\t\\t\\t\\tpadding-bottom: 1.0em;\\r\\n\\t\\t\\t\\tmargin-top: 20px; \\r\\n\\t\\t\\t}\\r\\n\\t\\t</style>\\r\\n        \\r\\n        <script type="text/javascript">\\n<!--\\n/*\\nWritten by Massimo Di Pierro.\\n\\nThis is a minimalistic AJAX for web2py, for more sophisticated stuff\\nyou should use Scriptacolous or some other AJAX toolkit. Anyway...\\n\\nTo use web2py_ajax.html just make sure you include \\\'web2py_ajax.html\\\'\\nin your layout.html. This provides four functions:\\n\\npopup(url)\\ncollapse(id)\\nfade(id,value) // try value= +0.1 or -0.1\\najax(url,sources,taget) \\n// will send sources[i].value to url and dispaly result in target\\n*/\\n\\nfunction popup(url) {\\n  newwindow=window.open(url,\\\'name\\\',\\\'height=400,width=600\\\');\\n  if (window.focus) {newwindow.focus()}\\n  return false;\\n}\\n\\nfunction collapse(id) {\\n   if(this.document.getElementById(id).style.display=="none")\\n   (this.document.getElementById(id).style.display="block") ;\\n   else (this.document.getElementById(id).style.display="none") ;\\n}\\n\\nfunction fade(id,value) {\\n  var object=document.getElementById(id);\\n  if(value<0 && !object.style.opacity) {\\n     this.document.getElementById(id).style.display="block";\\n     object.style.opacity=1;\\n  }\\n  if(value>0 && object.style.opacity>=1) object.style.opacity=1;\\n  else if(value<0 && object.style.opacity<=0) {\\n     this.document.getElementById(id).style.display="none";\\n     object.style.opacity=0;\\n  }\\n  else {\\n     this.document.getElementById(id).style.display="block";\\n     object.style.opacity-=-value;\\n     setTimeout(function(){fade(id,value);},100);\\n     return false;\\n  }\\n  return true;\\n}\\n\\nfunction ajax(url,sources,target) {\\n  var req = null; \\n  var ctarget=document.getElementById(target);\\n  window.status="connecting...";\\n  if(window.XMLHttpRequest)\\n     req = new XMLHttpRequest(); \\n  else if (window.ActiveXObject)\\n     req  = new ActiveXObject("Microsoft.XMLHTTP");\\n  req.onreadystatechange = function() {\\n     window.status="waiting...";\\n     if(req.readyState == 4)\\n       if(req.status == 200) {\\n          window.status=\\\'Ajax Done!\\\'\\n          try { \\n             ctarget.innerHTML=req.responseText; \\n             try {ctarget.scrollTop=ctarget.scrollHeight-ctarget.clientHeight;}\\n             catch(err) {}\\n          } catch(err) { ctarget.value=req.responseText; }\\n       } else alert("AJAX Error: " + req.status);\\n  }\\n  var query=""\\n  for(i=0; i<sources.length; i++) {\\n     if(i>0) query=query+"&";\\n     query=query+encodeURIComponent(sources[i])+"="+encodeURIComponent(document.getElementById(sources[i]).value);\\n  }\\n  req.open("POST",url,true); \\n  req.setRequestHeader("Content-Type", "application/x-www-form-urlencoded"); \\n  req.send(query); \\n} \\n//-->\\n</script>\\r\\n        \\r\\n    </head>\\r\\n\\r\\n    <body \',escape=False)\nif response.flash:\n    response.write(\'onload="fade(\\\'flash\\\',0.1);"\',escape=False)\n    pass\nresponse.write(\'>\\r\\n        <div id="page">\\r\\n\\r\\n            <div id="header">\\r\\n                <div id="headerimg">\\r\\n                    <h1>\\r\\n                        <a href="/\',escape=False)\nresponse.write(request.application)\nresponse.write(\'/default/index/">\\r\\n                        \\t[web2py<sup style="font-size:0.5em;">TM</sup>]\\r\\n                        \\t\',escape=False)\nresponse.write(request.application)\nresponse.write(\'\\r\\n\\t\\t\\t\\t\\t\\t</a>\\r\\n                    </h1>\\r\\n            \\r\\n                    <div class="description">\\r\\n                        \',escape=False)\nresponse.write(response.description)\nresponse.write(\'\\r\\n                    </div>\\r\\n                </div>\\r\\n            </div>\\r\\n        \\r\\n            <hr />\\r\\n\\r\\n            <div id="content" class="narrowcolumn">\\r\\n            \\r\\n                \',escape=False)\nif response.flash:\n    response.write(\'\\r\\n                    <div id="flash">\',escape=False)\n    response.write(response.flash)\n    response.write(\'</div>\\r\\n                \',escape=False)\n    pass\nresponse.write(\'\\r\\n            \\r\\n                \\r\\n\\r\\n\',escape=False)\n\ndef get_post_cats(post_id):\n    cats=db((db.cat_to_post.post_id == post_id) & (db.cat_to_post.cat_id == db.categories.id)).select(db.categories.ALL)\n    items=[]\n    for cat in cats:\n        item="<a href=\'/%(app)s/default/category/%(cat)s\'>%(name)s</a>" % {\'app\':request.application, \'cat\':cat.category_name, \'name\':cat.category_name}\n        items.append(item)\n        pass\n    cat_list=", ".join(items)\n    return XML(cat_list)\n\ndef get_comment_count(post_id):\n    com_count=len(db(db.comments.post_id==post_id).select(db.comments.ALL))\n    if com_count == 0:\n        com_text="No Comments &raquo;"\n    elif com_count == 1:\n        com_text="1 Comment &raquo;"\n    else:\n        com_text="%s Comments &raquo;" % com_count\n        pass\n    com_link = "<a href=\'/%(app)s/default/post/%(id)s#comments\'>%(text)s</a>" % {\'app\':request.application, \'id\':post_id, \'text\':com_text}\n    return XML(com_link)\n\nresponse.write(\'\\r\\n\\r\\n<h2 class="pagetitle">Archive for the &#8216;\',escape=False)\nresponse.write(request.args[0])\nresponse.write(\'&#8217; Category</h2>\\r\\n\\r\\n\',escape=False)\nif posts:\n    response.write(\'\\r\\n\\t\',escape=False)\n    for post in posts:\n        response.write(\'\\r\\n\\t<div class="post">\\r\\n\\t    <h2><a href="/\',escape=False)\n        response.write(request.application)\n        response.write(\'/default/post/\',escape=False)\n        response.write(post.id)\n        response.write(\'">\',escape=False)\n        response.write(post.post_title)\n        response.write(\'</a></h2>\\r\\n\\t    <small>\',escape=False)\n        response.write(post.post_time.strftime("%B %d, %Y"))\n        response.write(\'</small>\\r\\n\\t    <div class="entry">\\r\\n\\t    \\t<p>\\r\\n\\t\\t\\t\\t\',escape=False)\n        response.write(post.post_text)\n        response.write(\'\\r\\n\\t    \\t</p>\\r\\n\\t    </div>\\r\\n\\t\\t<p class="postmetadata">\\r\\n\\t\\t\\tPosted in \',escape=False)\n        response.write(get_post_cats(post.id))\n        response.write(\' | \',escape=False)\n        if session.authorized:\n            response.write(\'<a href="/\',escape=False)\n            response.write(request.application)\n            response.write(\'/default/edit/post/\',escape=False)\n            response.write(post.id)\n            response.write(\'">Edit</a> | \',escape=False)\n            pass\n        response.write(\'\',escape=False)\n        response.write(get_comment_count(post.id))\n        response.write(\'\\r\\n\\t\\t</p>\\r\\n\\t</div>\\r\\n\\t\',escape=False)\n        pass\n    response.write(\'\\r\\n\',escape=False)\nelse:\n    response.write(\'\\r\\n\\t<h2 class="center">Not Found</h2>\\r\\n\\t<p class="center">Sorry, but you are looking for something that isn\\\'t here.</p>\\r\\n\',escape=False)\n    pass\nresponse.write(\'\\r\\n        \\r\\n            </div>\\r\\n\\r\\n            <div id="sidebar">\\r\\n\\t\\t\\t\\t<ul>\\r\\n\\t\\t\\t\\t\\t\\r\\n\\t\\t\\t\\t\\t\',escape=False)\nif response.sidebar_note:\n    response.write(\'\\r\\n\\t\\t\\t\\t\\t\\t<li>\\r\\n\\t\\t\\t\\t\\t\\t\\t<p>\',escape=False)\n    response.write(response.sidebar_note)\n    response.write(\'</p>\\r\\n\\t\\t\\t\\t\\t\\t</li>\\t\\r\\n\\t\\t\\t\\t\\t\',escape=False)\n    pass\nresponse.write(\'\\r\\n\\t\\t\\t\\t\\t\\r\\n\\t\\t\\t\\t\\t\',escape=False)\nif response.menu:\n    response.write(\'\\r\\n\\t\\t\\t\\t\\t\\t<li>\\r\\n\\t\\t                \\t<h2 class="widgettitle">Pages</h2>\\r\\n\\t\\t                \\t<ul>\\r\\n\\t\\t                    \\t\',escape=False)\n    for _name,_active,_link in response.menu:\n        response.write(\'\\r\\n\\t\\t                            <li><a href="\',escape=False)\n        response.write(_link)\n        response.write(\'" \',escape=False)\n        if not _active:\n            response.write(\'class="inactive"\',escape=False)\n            pass\n        response.write(\'>\',escape=False)\n        response.write(_name)\n        response.write(\'</a></li>\\r\\n\\t\\t                        \',escape=False)\n        pass\n    response.write(\'\\r\\n\\t\\t                    </ul>\\r\\n\\t\\t\\t\\t\\t\\t</li>\\r\\n\\t\\t\\t\\t\\t\',escape=False)\n    pass\nresponse.write(\'\\r\\n\\t\\t\\t\\t\\t\\r\\n\\t\\t\\t\\t\\t\',escape=False)\nif response.categories:\n    response.write(\'\\r\\n\\t\\t\\t\\t\\t\\t<li>\\r\\n\\t\\t                \\t<h2 class="widgettitle">\\r\\n\\t\\t                \\t\\tCategories\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\',escape=False)\n    if session.authorized:\n        response.write(\'\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t<span style="font-size: .8em; font-weight: normal;">\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t[<a href="/\',escape=False)\n        response.write(request.application)\n        response.write(\'/default/manage/category">manage</a>]\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t</span>\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\',escape=False)\n        pass\n    response.write(\'\\t\\t\\t\\t\\t\\r\\n\\t\\t\\t\\t\\t\\t\\t</h2>\\r\\n\\t\\t                \\t<ul>\\r\\n\\t\\t                    \\t\',escape=False)\n    for _name,_count,_link in response.categories:\n        response.write(\'\\r\\n\\t\\t                            <li><a href="\',escape=False)\n        response.write(_link)\n        response.write(\'">\',escape=False)\n        response.write(_name)\n        response.write(\'</a> (\',escape=False)\n        response.write(_count)\n        response.write(\')</li>\\r\\n\\t\\t                        \',escape=False)\n        pass\n    response.write(\'\\r\\n\\t\\t                    </ul>\\t\\t\\t\\t\\t\\r\\n\\t\\t\\t\\t\\t\\t</li>\\r\\n\\t\\t\\t\\t\\t\',escape=False)\n    pass\nresponse.write(\'\\r\\n\\t\\t\\t\\t\\t\\r\\n\\t\\t\\t\\t\\t\',escape=False)\nif response.links:\n    response.write(\'\\r\\n\\t\\t\\t\\t\\t\\t<li>\\r\\n\\t\\t                \\t<h2 class="widgettitle">\\r\\n\\t\\t                \\t\\tLinks \\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\',escape=False)\n    if session.authorized:\n        response.write(\'\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t<span style="font-size: .8em; font-weight: normal;">\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t[<a href="/\',escape=False)\n        response.write(request.application)\n        response.write(\'/default/manage/link">manage</a>]\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t</span>\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\',escape=False)\n        pass\n    response.write(\'\\r\\n\\t\\t\\t\\t\\t\\t\\t</h2>\\r\\n\\t\\t               \\t\\t<ul>\\r\\n\\t\\t                    \\t\',escape=False)\n    for _name,_link,_id in response.links:\n        response.write(\'\\r\\n\\t\\t                            <li>\\r\\n\\t\\t                            \\t<a target="_blank" href="\',escape=False)\n        response.write(_link)\n        response.write(\'">\',escape=False)\n        response.write(_name)\n        response.write(\'</a>\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t</li>\\r\\n\\t\\t                        \',escape=False)\n        pass\n    response.write(\'\\r\\n\\t\\t                    </ul>\\t\\t\\t\\t\\t\\t\\r\\n\\t\\t\\t\\t\\t\\t</li>\\r\\n\\t\\t\\t\\t\\t\',escape=False)\n    pass\nresponse.write(\'\\r\\n\\t\\t\\t\\t\\t\\r\\n\\t\\t\\t\\t\\t\',escape=False)\nif session.authorized:\n    response.write(\'\\r\\n\\t\\t\\t\\t\\t\\t<li>\\r\\n\\t\\t\\t\\t\\t\\t\\t<h2>Mini Admin</h2>\\r\\n\\t\\t\\t\\t\\t\\t\\t<ul>\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t<li><a href="/\',escape=False)\n    response.write(request.application)\n    response.write(\'/default/add/page">Add Page</a></li>\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t<li><a href="/\',escape=False)\n    response.write(request.application)\n    response.write(\'/default/add/post">Add Post</a></li>\\r\\n\\t\\t\\t\\t\\t\\t\\t</ul>\\r\\n\\t\\t\\t\\t\\t\\t</li>\\r\\n\\t\\t\\t\\t\\t\',escape=False)\n    pass\nresponse.write(\'\\r\\n\\t\\t\\t\\t</ul>\\r\\n            </div>\\r\\n\\r\\n            <hr />\\r\\n            \\r\\n            <div id="footer" style="height: 63px;">\\r\\n                <p>\\r\\n                    Powered by <a href="http://www.web2py.com">web2py</a> (TM) created by Massimo Di Pierro &copy; 2007, 2008\\r\\n                </p>\\r\\n            </div>\\r\\n            \\r\\n        </div>\\r\\n\\r\\n    </body>\\r\\n</html>\',escape=False)\n'
p6
sS'traceback'
p7
S'Traceback (most recent call last):\n  File "C:\\Documents and Settings\\csharp\\Desktop\\web2py\\gluon\\restricted.py", line 60, in restricted\n    exec ccode in environment\n  File "applications/blog/views/default/category.html", line 77, in <module>\n  File "applications/blog/views/default/category.html", line 39, in get_post_cats\n    <p class="postmetadata">\n  File "C:\\Documents and Settings\\csharp\\Desktop\\web2py\\gluon\\sql.py", line 174, in __getattr__\n    def __getattr__(self, key): return self[key]\nKeyError: \'cat_to_post\'\n'
p8
s.